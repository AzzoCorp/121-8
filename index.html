<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map - Display a map</title>
  <style>
    html, body {margin: 0px; height: 100%; width: 100%; background: transparent;}
    .container {width: 100%; height: 100%; background: transparent;}
    .depotsS {
      --line-color: #ff00fe;
      --line-width: 1;
      --fill-color: #ff00fe;
      --fill-opacity: 1;
    }
    .favorablesS {
      --line-color: #009cff;
      --line-width: 1;
      --fill-color: #009cff;
      --fill-opacity: 1;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/maptalks/dist/maptalks.css">
  <script type="text/javascript" src="https://unpkg.com/maptalks/dist/maptalks.min.js"></script>
</head>
<body>
  <div id="map" class="container"></div>
  <script type="module">
    var map = new maptalks.Map('map', {
      center: [9.27970, 41.59099], zoom: 10,
      baseLayer: new maptalks.TileLayer('base', {
        urlTemplate: 'https://{s}.tile.osm.org/{z}/{x}/{y}.png', subdomains: ["a", "b", "c"]
      }), layers: []
    });

    function changeView() {
      map.animateTo({ center: [9.27970, 41.59099], zoom: 5, pitch: 60, bearing: 20 }, {duration: 5000});
      setTimeout(function() {
        map.animateTo({ center: [9.27970, 41.59099], zoom: 17, pitch: 55, bearing: 90 }, {duration: 5000});
      }, 5000);
    }

    async function addGeoJSONLayer(type, className) {
      try {
        console.log(`Loading GeoJSON data for type: ${type}`);
        
        // Dynamically import the GeoJSON data based on the type
        const module = await import(`./GeoDatas/${type}.js`);
        console.log(`GeoJSON module loaded for type: ${type}`, module);

        const geojson = module.default || module; // Adjust based on how the module exports the data
        console.log(`GeoJSON data for type: ${type}`, geojson);

        // Get the computed styles for the specified className
        const element = document.querySelector(`.${className}`);
        if (!element) {
          throw new Error(`Element with class name ${className} not found`);
        }
        const style = getComputedStyle(element);
        const symbol = {
          'lineColor': style.getPropertyValue('--line-color').trim(),
          'lineWidth': parseFloat(style.getPropertyValue('--line-width')),
          'polygonFill': style.getPropertyValue('--fill-color').trim(),
          'polygonOpacity': parseFloat(style.getPropertyValue('--fill-opacity'))
        };
        console.log(`Symbol for type: ${type}`, symbol);

        // Convert the GeoJSON data to geometries using maptalks
        const geometries = maptalks.GeoJSON.toGeometry(geojson);
        console.log(`Geometries for type: ${type}`, geometries);

        const vectorLayer = new maptalks.VectorLayer().addTo(map);
        console.log(`Vector layer created for type: ${type}`);

        // Add the geometries to the vector layer and apply the styles
        vectorLayer.addGeometry(geometries);
        geometries.forEach(geometry => geometry.setSymbol(symbol));
        console.log(`Geometries added to vector layer for type: ${type}`);
      } catch (error) {
        console.error('Error loading GeoJSON data:', error);
      }
    }

    changeView();
    addGeoJSONLayer('depots', 'depotsS');
    addGeoJSONLayer('favorables', 'favorablesS');
  </script>
</body>
</html>
